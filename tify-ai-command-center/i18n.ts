// tify-ai-command-center/i18n.ts
import React, { createContext, useContext, useMemo, useState, useEffect } from 'react';

type Lang = 'en' | 'es' | 'pt';

const resources: Record<Lang, Record<string, string>> = {
  en: {
    'app.title': 'Tify',
    'app.subtitle': 'Command Center',
    'nav.dashboard': 'Dashboard',
    'nav.channels': 'Channels',
    'nav.messages': 'Messages',
    'nav.approvals': 'Approvals',
    'nav.users': 'Users',
    'nav.ai': 'Tify Brain',
    'nav.intelligence': 'Intelligence',
    'nav.monitoring': 'Monitoring',
    'common.language': 'Language',
    'common.visit': 'Visit',
    'common.open': 'Open',
    'common.noWebsite': 'No website',
    'common.refresh': 'Refresh',
    'common.save': 'Save',
    'common.send': 'Send',
    'common.sending': 'Sending...',

    'channels.title': 'Channels',
    'channels.filterPlaceholder': 'Filter channels...',
    'channels.create': 'Create',
    'channels.configuration': 'Configuration',
    'channels.governance': 'Governance',
    'channels.contactLinks': 'Contact & Links',
    'channels.visibility': 'Visibility',
    'channels.public': 'Public',
    'channels.private': 'Private',
    'channels.searchable': 'Searchable',
    'channels.searchable_yes': 'Yes',
    'channels.searchable_no': 'No (Reference Code Only)',
    'channels.refCode': 'Ref Code',
    'channels.policy': 'Policy',
    'channels.members': 'Members',
    'channels.subscriptions': 'Subscriptions',
    'channels.subchannels': 'Subchannels',
    'channels.approvers': 'Approvers',
    'channels.approvers_empty': 'No approvers',
    'channels.add': 'Add',
    'channels.remove': 'Remove',
    'channels.createSubchannel': 'Create subchannel',
    'channels.website': 'Website',
    'channels.noSocialLinks': 'No social links',
    'channels.selectPrompt': 'Select a channel to view details',
    'stats.delivered': 'Delivered',
    'stats.read': 'Read',
    'stats.unread': 'Unread',
    'stats.subscribers': 'Subscribers',
    'stats.approvers': 'Approvers',
    'stats.range.1h': '1H',
    'stats.range.24h': '24H',
    'stats.range.7d': '1 Week',
    'stats.range.1m': '1 Month',
    'stats.range.all': 'All time',

    'dashboard.overview': 'Overview',
    'dashboard.metrics': 'Real-time platform metrics',
    'dashboard.systemOperational': 'System Operational',
    'dashboard.totalReach': 'Total Reach',
    'dashboard.pendingApprovals': 'Pending Approvals',
    'dashboard.requiresAttention': 'Requires attention',
    'dashboard.messagesSent': 'Messages Sent',
    'dashboard.lifetimeTotal': 'Lifetime total',
    'dashboard.verifiedChannels': 'Verified Channels',
    'dashboard.trustSafety': 'Trust & Safety Verified',
    'dashboard.messageActivity': 'Message Activity',
    'dashboard.recentActivity': 'Recent Activity',
    'dashboard.noRecentActivity': 'No recent activity.',
    'dashboard.viewAllMessages': 'View All Messages',
    'dashboard.loading': 'Loading Dashboard...',

    'compose.title': 'Compose Message',
    'feedback.sent': 'Message sent successfully!',
    'feedback.failed': 'Failed to send',
    'destinationChannel': 'Destination Channel',
    'content': 'Content',
    'content.placeholder': 'Type your message here or ask AI to draft it...',
    'ai.polish': 'AI Polish',
    'ai.drafting': 'Drafting...',
    'priority': 'Priority',
    'emergencyBroadcast': 'Emergency Broadcast',
    'deliveryPreview': 'Delivery Preview',
    'estDelivery': 'Est. Delivery',
    'instant': 'Instant',
    'bypassDnd': 'Bypasses Do Not Disturb',
    'attachmentsAllowed': 'Attachments allowed (Verified Channel)',
    'saveDraft': 'Save Draft',
    'sendMessage': 'Send Message',
    'schedule.sendAt': 'Schedule send',
    'schedule.eventAt': 'Event date',
    'schedule.expiresAt': 'Fulfillment (expires)',
    'delivery.scheduled': 'Scheduled',
    'delivery.instant': 'Instant',

    'approval.queue': 'Approval Queue',
    'approval.subtitle': 'Review messages requiring authorization before delivery.',
    'approval.pending': 'Pending',
    'approval.allCaughtUp': 'All caught up! ',
    'approval.noPending': 'No pending messages requiring approval.',
    'approval.refresh': 'Refresh',
    'approval.loading': 'Loading queue...',
    'approval.approve': 'Approve',
    'approval.reject': 'Reject',
    'approval.by': 'By',
    'approval.emergencyMode': 'Emergency Mode',
    'approval.unknownChannel': 'Unknown Channel',
    'approval.priorityLabel': 'Priority',
    'priority.high': 'High',
    'priority.medium': 'Medium',
    'priority.low': 'Low',

    'ai.headerTitle': 'Tify Neural Interface',
    'ai.powered': 'Powered by Gemini 2.5 Flash',
    'ai.online': 'ONLINE',
    'ai.placeholder': 'Ask Tify to draft a message, analyze channel stats, or explain verification policies...',
    'ai.disclaimer': 'AI can make mistakes. Review generated actions before execution.',
    'ai.initialWelcome': "Hello Administrator. I am the Tify Brain. I have full context of your organization's channels, users, and message queues. How can I assist you today?",

    'users.searchPlaceholder': 'Search users...',
    'users.clear': 'Clear',
    'users.createUser': 'Create user',
    'users.loading': 'Loading users',
    'users.selectUser': 'Select a user',
    'users.phone': 'Phone',
    'users.verified': 'Verified',
    'users.notVerified': 'Not verified',
    'users.code': 'Code',
    'users.expires': 'expires',
    'users.copy': 'Copy',
    'users.generateCode': 'Generate code',
    'users.subscriptions': 'Subscriptions',
    'users.messages': 'Messages',
    'users.ownedChannels': 'Owned channels',
    'users.noResults': 'No results',
    'users.noSubscriptions': 'No active subscriptions',
    'users.assignments': 'Approver assignments',
    'users.noAssignments': 'No assignments',
    'users.pendingApprovals': 'Pending approvals',
    'users.noPending': 'No recent pending',
    'users.window': 'Window (h)',
    'users.refresh': 'Refresh',
  },
  es: {
    'app.title': 'Tify',
    'app.subtitle': 'Centro de Comando',
    'nav.dashboard': 'Panel',
    'nav.channels': 'Canales',
    'nav.messages': 'Mensajes',
    'nav.approvals': 'Aprobaciones',
    'nav.users': 'Usuarios',
    'nav.ai': 'Tify Brain',
    'nav.intelligence': 'Inteligencia',
    'nav.monitoring': 'Monitoreo',
    'common.language': 'Idioma',
    'common.visit': 'Visitar',
    'common.open': 'Abrir',
    'common.noWebsite': 'Sin sitio web',
    'common.refresh': 'Refrescar',
    'common.save': 'Guardar',
    'common.send': 'Enviar',
    'common.sending': 'Enviando...',

    'channels.title': 'Canales',
    'channels.filterPlaceholder': 'Filtrar canales...',
    'channels.create': 'Crear',
    'channels.configuration': 'Configuración',
    'channels.governance': 'Gobernanza',
    'channels.contactLinks': 'Contacto y Enlaces',
    'channels.visibility': 'Visibilidad',
    'channels.public': 'Público',
    'channels.private': 'Privado',
    'channels.searchable': 'Buscable',
    'channels.searchable_yes': 'Sí',
    'channels.searchable_no': 'No (solo código de referencia)',
    'channels.refCode': 'Código Ref',
    'channels.policy': 'Política',
    'channels.members': 'Miembros',
    'channels.subscriptions': 'Suscripciones',
    'channels.subchannels': 'Subcanales',
    'channels.approvers': 'Aprobadores',
    'channels.approvers_empty': 'Sin aprobadores',
    'channels.add': 'Añadir',
    'channels.remove': 'Eliminar',
    'channels.createSubchannel': 'Crear subcanal',
    'channels.website': 'Sitio web',
    'channels.noSocialLinks': 'Sin enlaces sociales',
    'channels.selectPrompt': 'Selecciona un canal para ver detalles',
    'stats.delivered': 'Entregados',
    'stats.read': 'Leídos',
    'stats.unread': 'Sin leer',
    'stats.subscribers': 'Inscritos',
    'stats.approvers': 'Aprobadores',
    'stats.range.1h': '1H',
    'stats.range.24h': '24H',
    'stats.range.7d': '1 Semana',
    'stats.range.1m': '1 Mes',
    'stats.range.all': 'Histórico',

    'dashboard.overview': 'Resumen',
    'dashboard.metrics': 'Métricas en tiempo real',
    'dashboard.systemOperational': 'Sistema Operativo',
    'dashboard.totalReach': 'Alcance total',
    'dashboard.pendingApprovals': 'Pendientes por aprobar',
    'dashboard.requiresAttention': 'Requiere atención',
    'dashboard.messagesSent': 'Mensajes enviados',
    'dashboard.lifetimeTotal': 'Acumulado histórico',
    'dashboard.verifiedChannels': 'Canales verificados',
    'dashboard.trustSafety': 'Verificado (Confianza y Seguridad)',
    'dashboard.messageActivity': 'Actividad de mensajes',
    'dashboard.recentActivity': 'Actividad reciente',
    'dashboard.noRecentActivity': 'Sin actividad reciente.',
    'dashboard.viewAllMessages': 'Ver todos los mensajes',
    'dashboard.loading': 'Cargando Panel...',

    'compose.title': 'Redactar Mensaje',
    'feedback.sent': '¡Mensaje enviado con éxito!',
    'feedback.failed': 'Fallo al enviar',
    'destinationChannel': 'Canal de destino',
    'content': 'Contenido',
    'content.placeholder': 'Escribe tu mensaje o pide a la IA que lo redacte...',
    'ai.polish': 'Pulir con IA',
    'ai.drafting': 'Redactando...',
    'priority': 'Prioridad',
    'emergencyBroadcast': 'Difusión de emergencia',
    'deliveryPreview': 'Vista de entrega',
    'estDelivery': 'Entrega est.',
    'instant': 'Instantánea',
    'bypassDnd': 'Ignora No Molestar',
    'attachmentsAllowed': 'Adjuntos permitidos (Canal verificado)',
    'saveDraft': 'Guardar borrador',
    'sendMessage': 'Enviar mensaje',
    'schedule.sendAt': 'Programar envío',
    'schedule.eventAt': 'Fecha del evento',
    'schedule.expiresAt': 'Cumplimiento (vence)',
    'delivery.scheduled': 'Programado',
    'delivery.instant': 'Instantáneo',

    'approval.queue': 'Cola de Aprobación',
    'approval.subtitle': 'Revisa mensajes que requieren autorización antes de la entrega.',
    'approval.pending': 'Pendientes',
    'approval.allCaughtUp': '¡Todo al día!',
    'approval.noPending': 'No hay mensajes pendientes de aprobación.',
    'approval.refresh': 'Refrescar',
    'approval.loading': 'Cargando cola...',
    'approval.approve': 'Aprobar',
    'approval.reject': 'Rechazar',
    'approval.by': 'Por',
    'approval.emergencyMode': 'Modo emergencia',
    'approval.unknownChannel': 'Canal desconocido',
    'approval.priorityLabel': 'Prioridad',
    'priority.high': 'Alta',
    'priority.medium': 'Media',
    'priority.low': 'Baja',

    'ai.headerTitle': 'Interfaz Neural Tify',
    'ai.powered': 'Impulsado por Gemini 2.5 Flash',
    'ai.online': 'EN LÍNEA',
    'ai.placeholder': 'Pide a Tify que redacte un mensaje, analice estadísticas o explique políticas de verificación...',
    'ai.disclaimer': 'La IA puede cometer errores. Revisa las acciones generadas antes de ejecutarlas.',
    'ai.initialWelcome': 'Hola Administrador. Soy el Tify Brain. Tengo contexto completo de los canales, usuarios y colas de mensajes. ¿Cómo puedo ayudarte hoy?',

    'users.searchPlaceholder': 'Buscar usuarios...',
    'users.clear': 'Limpiar',
    'users.createUser': 'Crear usuario',
    'users.loading': 'Cargando usuarios',
    'users.selectUser': 'Selecciona un usuario',
    'users.phone': 'Teléfono',
    'users.verified': 'Verificado',
    'users.notVerified': 'No verificado',
    'users.code': 'Código',
    'users.expires': 'expira',
    'users.copy': 'Copiar',
    'users.generateCode': 'Generar código',
    'users.subscriptions': 'Suscripciones',
    'users.messages': 'Mensajes',
    'users.ownedChannels': 'Canales propios',
    'users.noResults': 'Sin resultados',
    'users.noSubscriptions': 'Sin suscripciones activas',
    'users.assignments': 'Asignaciones como aprobador',
    'users.noAssignments': 'Sin asignaciones',
    'users.pendingApprovals': 'Pendientes por aprobar',
    'users.noPending': 'Sin pendientes recientes',
    'users.window': 'Ventana (h)',
    'users.refresh': 'Refrescar',
  },
  pt: {
    'app.title': 'Tify',
    'app.subtitle': 'Centro de Comando',
    'nav.dashboard': 'Painel',
    'nav.channels': 'Canais',
    'nav.messages': 'Mensagens',
    'nav.approvals': 'Aprovações',
    'nav.users': 'Usuários',
    'nav.ai': 'Tify Brain',
    'nav.intelligence': 'Inteligência',
    'nav.monitoring': 'Monitoramento',
    'common.language': 'Idioma',
    'common.visit': 'Visitar',
    'common.open': 'Abrir',
    'common.noWebsite': 'Sem site',
    'common.refresh': 'Atualizar',
    'common.save': 'Salvar',
    'common.send': 'Enviar',
    'common.sending': 'Enviando...',

    'channels.title': 'Canais',
    'channels.filterPlaceholder': 'Filtrar canais...',
    'channels.create': 'Criar',
    'channels.configuration': 'Configuração',
    'channels.governance': 'Governança',
    'channels.contactLinks': 'Contato e Links',
    'channels.visibility': 'Visibilidade',
    'channels.public': 'Público',
    'channels.private': 'Privado',
    'channels.searchable': 'Pesquisável',
    'channels.searchable_yes': 'Sim',
    'channels.searchable_no': 'Não (apenas código de referência)',
    'channels.refCode': 'Código Ref',
    'channels.policy': 'Política',
    'channels.members': 'Membros',
    'channels.subscriptions': 'Inscrições',
    'channels.subchannels': 'Subcanais',
    'channels.approvers': 'Aprovadores',
    'channels.approvers_empty': 'Sem aprovadores',
    'channels.add': 'Adicionar',
    'channels.remove': 'Remover',
    'channels.createSubchannel': 'Criar subcanal',
    'channels.website': 'Site',
    'channels.noSocialLinks': 'Sem links sociais',
    'channels.selectPrompt': 'Selecione um canal para ver detalhes',
    'stats.delivered': 'Entregues',
    'stats.read': 'Lidos',
    'stats.unread': 'Não lidos',
    'stats.subscribers': 'Inscritos',
    'stats.approvers': 'Aprovadores',
    'stats.range.1h': '1H',
    'stats.range.24h': '24H',
    'stats.range.7d': '1 Semana',
    'stats.range.1m': '1 Mês',
    'stats.range.all': 'Histórico',

    'dashboard.overview': 'Visão geral',
    'dashboard.metrics': 'Métricas em tempo real',
    'dashboard.systemOperational': 'Sistema operacional',
    'dashboard.totalReach': 'Alcance total',
    'dashboard.pendingApprovals': 'Pendentes para aprovar',
    'dashboard.requiresAttention': 'Requer atenção',
    'dashboard.messagesSent': 'Mensagens enviadas',
    'dashboard.lifetimeTotal': 'Total histórico',
    'dashboard.verifiedChannels': 'Canais verificados',
    'dashboard.trustSafety': 'Verificado (Confiança e Segurança)',
    'dashboard.messageActivity': 'Atividade de mensagens',
    'dashboard.recentActivity': 'Atividade recente',
    'dashboard.noRecentActivity': 'Sem atividade recente.',
    'dashboard.viewAllMessages': 'Ver todas as mensagens',
    'dashboard.loading': 'Carregando Painel...',

    'compose.title': 'Redigir Mensagem',
    'feedback.sent': 'Mensagem enviada com sucesso!',
    'feedback.failed': 'Falha ao enviar',
    'destinationChannel': 'Canal de destino',
    'content': 'Conteúdo',
    'content.placeholder': 'Digite sua mensagem ou peça à IA para redigir...',
    'ai.polish': 'Polir com IA',
    'ai.drafting': 'Redigindo...',
    'priority': 'Prioridade',
    'emergencyBroadcast': 'Transmissão de emergência',
    'deliveryPreview': 'Prévia de entrega',
    'estDelivery': 'Entrega est.',
    'instant': 'Instantânea',
    'bypassDnd': 'Ignora Não Perturbe',
    'attachmentsAllowed': 'Anexos permitidos (Canal verificado)',
    'saveDraft': 'Salvar rascunho',
    'sendMessage': 'Enviar mensagem',
    'schedule.sendAt': 'Agendar envio',
    'schedule.eventAt': 'Data do evento',
    'schedule.expiresAt': 'Cumprimento (expira)',
    'delivery.scheduled': 'Agendado',
    'delivery.instant': 'Instantâneo',

    'approval.queue': 'Fila de Aprovação',
    'approval.subtitle': 'Revisar mensagens que exigem autorização antes da entrega.',
    'approval.pending': 'Pendentes',
    'approval.allCaughtUp': 'Tudo em dia!',
    'approval.noPending': 'Sem mensagens pendentes de aprovação.',
    'approval.refresh': 'Atualizar',
    'approval.loading': 'Carregando fila...',
    'approval.approve': 'Aprovar',
    'approval.reject': 'Rejeitar',
    'approval.by': 'Por',
    'approval.emergencyMode': 'Modo emergência',
    'approval.unknownChannel': 'Canal desconhecido',
    'approval.priorityLabel': 'Prioridade',
    'priority.high': 'Alta',
    'priority.medium': 'Média',
    'priority.low': 'Baixa',

    'ai.headerTitle': 'Interface Neural Tify',
    'ai.powered': 'Com Gemini 2.5 Flash',
    'ai.online': 'ONLINE',
    'ai.placeholder': 'Peça ao Tify para redigir uma mensagem, analisar estatísticas ou explicar políticas...',
    'ai.disclaimer': 'A IA pode errar. Revise ações geradas antes de executá-las.',
    'ai.initialWelcome': 'Olá Administrador. Sou o Tify Brain. Tenho contexto completo de canais, usuários e filas de mensagens. Como posso ajudar hoje?',

    'users.searchPlaceholder': 'Buscar usuários...',
    'users.clear': 'Limpar',
    'users.createUser': 'Criar usuário',
    'users.loading': 'Carregando usuários',
    'users.selectUser': 'Selecione um usuário',
    'users.phone': 'Telefone',
    'users.verified': 'Verificado',
    'users.notVerified': 'Não verificado',
    'users.code': 'Código',
    'users.expires': 'expira',
    'users.copy': 'Copiar',
    'users.generateCode': 'Gerar código',
    'users.subscriptions': 'Inscrições',
    'users.messages': 'Mensagens',
    'users.ownedChannels': 'Canais próprios',
    'users.noResults': 'Sem resultados',
    'users.noSubscriptions': 'Sem inscrições ativas',
    'users.assignments': 'Atribuições de aprovador',
    'users.noAssignments': 'Sem atribuições',
    'users.pendingApprovals': 'Pendentes para aprovar',
    'users.noPending': 'Sem pendentes recentes',
    'users.window': 'Janela (h)',
    'users.refresh': 'Atualizar',
  },
};

Object.assign(resources.en, {
  'auth.createAdmin': 'Create initial administrator',
  'auth.email': 'Email',
  'auth.username': 'Username',
  'auth.fullName': 'Full name',
  'auth.password': 'Password',
  'auth.verificationCode': 'Verification code',
  'auth.createAndEnter': 'Create and enter',
  'auth.login': 'Log in',
  'auth.emailOrUsername': 'Email or username',
  'auth.enter': 'Enter',
  'auth.forgotPassword': 'Forgot your password?',
  'auth.resetPassword': 'Reset password',
  'auth.requestReset': 'Request code',
  'auth.code': 'Code',
  'auth.newPassword': 'New password',
  'auth.reset': 'Reset and enter',
  'auth.backToLogin': 'Back to login',
  'auth.codeSent': 'If the user exists, a code has been sent',
  'status.connecting': 'Connecting...',
  'common.searchPlaceholder': 'Search channels, messages...',
  'module.underConstruction': 'Module under construction'
});
Object.assign(resources.es, {
  'auth.createAdmin': 'Crear administrador inicial',
  'auth.email': 'Email',
  'auth.username': 'Usuario',
  'auth.fullName': 'Nombre completo',
  'auth.password': 'Contraseña',
  'auth.verificationCode': 'Código de verificación',
  'auth.createAndEnter': 'Crear y entrar',
  'auth.login': 'Iniciar sesión',
  'auth.emailOrUsername': 'Email o usuario',
  'auth.enter': 'Entrar',
  'auth.forgotPassword': '¿Olvidaste tu contraseña?',
  'auth.resetPassword': 'Restablecer contraseña',
  'auth.requestReset': 'Solicitar código',
  'auth.code': 'Código',
  'auth.newPassword': 'Nueva contraseña',
  'auth.reset': 'Restablecer y entrar',
  'auth.backToLogin': 'Volver al inicio',
  'auth.codeSent': 'Si el usuario existe, se envió un código',
  'status.connecting': 'Conectando...',
  'common.searchPlaceholder': 'Buscar canales, mensajes...',
  'module.underConstruction': 'Módulo en construcción'
});
Object.assign(resources.pt, {
  'auth.createAdmin': 'Criar administrador inicial',
  'auth.email': 'Email',
  'auth.username': 'Usuário',
  'auth.fullName': 'Nome completo',
  'auth.password': 'Senha',
  'auth.verificationCode': 'Código de verificação',
  'auth.createAndEnter': 'Criar e entrar',
  'auth.login': 'Entrar',
  'auth.emailOrUsername': 'Email ou usuário',
  'auth.enter': 'Entrar',
  'auth.forgotPassword': 'Esqueceu a senha?',
  'auth.resetPassword': 'Redefinir senha',
  'auth.requestReset': 'Solicitar código',
  'auth.code': 'Código',
  'auth.newPassword': 'Nova senha',
  'auth.reset': 'Redefinir e entrar',
  'auth.backToLogin': 'Voltar ao login',
  'auth.codeSent': 'Se o usuário existir, um código foi enviado',
  'status.connecting': 'Conectando...',
  'common.searchPlaceholder': 'Buscar canais, mensagens...',
  'module.underConstruction': 'Módulo em construção'
});

const I18nCtx = createContext<{ lang: Lang; setLang: (l: Lang) => void; t: (k: string) => string }>({
  lang: 'es',
  setLang: () => {},
  t: (k) => k
});

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLang] = useState<Lang>('es');
  useEffect(() => {
    const saved = typeof localStorage !== 'undefined' ? (localStorage.getItem('tify_lang') as Lang | null) : null;
    if (saved) setLang(saved);
  }, []);
  const setLangPersist = (l: Lang) => {
    setLang(l);
    if (typeof localStorage !== 'undefined') localStorage.setItem('tify_lang', l);
  };
  const t = useMemo(() => {
    return (k: string) => {
      const dict = resources[lang] || resources.es;
      return dict[k] ?? resources.en[k] ?? k;
    };
  }, [lang]);
  return React.createElement(I18nCtx.Provider, { value: { lang, setLang: setLangPersist, t } }, children);
};

export const useI18n = () => useContext(I18nCtx);